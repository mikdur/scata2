{% extends "scata2_base.html" %}
{% block title %}Dataset set: {{ object.name }} - {{ object.create_date|date:"Y-m-d" }}{% endblock %}

{% block scata2_content %}
<div class="flex flex-wrap gap-8">
{% if  object.description %}
<div class="p-4 w-96 bg-stone-100 rounded-lg shadow-md">
<h2 class="text-lg font-serif font-bold">Description</h2>
<div class="prose">
    {{ object.description }}
</div>
</div>
{% endif %}
<div class="p-4 w-96 bg-stone-100 rounded-lg shadow-md">
<h2 class="pb-2 pt-4 text-lg font-serif font-bold">General</h2>
<table class="table-auto min-w-full">
    <tr>
        <td class="font-semibold">Amplicon:</td>
        <td class="text-right">{{ object.amplicon.name }}</td>
    </tr>
    <tr>
        <td class="font-semibold">Total sequences:</td>
        <td class="text-right font-mono">{{ object.seq_total }}</td>
    </tr>
    <tr>
        <td class="font-semibold">Accepted sequences:</td>
        <td class="text-right font-mono">{{ object.seq_count }}</td>
    </tr>
    <tr>
        <td class="font-semibold">Number of tags/samples:</td>
        <td class="text-right font-mono">{{ object.tag_count }}</td>
    </tr>
    <tr>
        <td class="font-semibold">Discarded sequences:</td>
        <td class="text-right font-mono">{{ discarded }}</td>
    </tr>
    <tr>
        <td class="font-semibold">Reverse complemented:</td>
        <td class="text-right font-mono">{{ object.seq_rev }}</td>
    </tr>

    <tr>
        <td class="font-semibold">File 1:</td>
        <td class="text-right font-mono">{{ object.file1.name }}</td>
    </tr>
    <tr>
        <td class="font-semibold">File 2:</td>
        <td class="text-right font-mono">{{ object.file2.name }}</td>
    </tr>

    <tr>
        <td class="font-semibold">Process time:</td>
        <td class="text-right font-mono">
            {{object.process_time|floatformat:"-2"}}s 
        </td>
    </tr>
</table>
</div>
{% if errors %}
<div class="p-4 w-96 bg-stone-100 rounded-lg shadow-md">

<h2 class="pb-2 pt-4 text-lg font-serif font-bold">Errors</h2>
<table class="table-auto min-w-full">
    {% for error in errors %}
    <tr>
        <td class="font-semibold">{{ error.message }}:</td>
        <td class="text-right font-mono">{{ error.count }}</td>
    </tr>
    {% endfor %}
</table>
{% endif %}
</div>
<div class="p-4 w-96 bg-stone-100 rounded-lg shadow-md">
<h2 class="pb-2 pt-2 text-lg font-serif font-bold">Settings</h2>
<table class="table-auto min-w-full">
    <tr>
        <td class="font-semibold">Filter method:</td>
        <td class="text-right font-mono">{{ object.filter_method }}</td>
    </tr>
    <tr>
        <td class="font-semibold">Mininimum quality:</td>
        <td class="text-right">{{ object.min_qual }}</td>
    </tr>
    <tr>
        <td class="font-semibold">Mininimum mean quality:</td>
        <td class="text-right">{{ object.mean_qual }}</td>
    </tr>
    <tr>
        <td class="font-semibold">Overlap kmer size/hsp count/#shared</td>
        <td class="text-right">{{ object.kmer_size }}/{{ object.kmer_hsp_count }}/{{ object.kmer_shared }}</td>
    </tr> 
</table>
</div>
{% if tags %}
<div class="p-4 bg-stone-100 rounded-lg shadow-md w-11/12">
    <h2 class="pb-2 pt-2 text-lg font-serif font-bold">Sample size distribution</h2>
    <div id="samplesize" class="min-w-full">
    </div>
</div>
<div class="p-4 bg-stone-100 rounded-lg shadow-md w-11/12">
    <h2 class="pb-2 pt-2 text-lg font-serif font-bold">Tag Table</h2>
    <table id="tags" class="table-auto">
        <thead>
            <tr>
                <td>Tag name</td>
                <td>#Sequences</td>
                <td>#Reversed</td>
                <td>Min length</td>
                <td>Mean length</td>
                <td>Max length</td>
                <td>%GC</td>
            </tr>
        </thead>
        <tbody>
        {% for tag in tags %}
        <tr>
            <td>
                {{ tag.tag }}
            </td>
            <td>
                {{ tag.count }}
            </td>
            <td>
                {{ tag.reversed }}
            </td>
            <td>
                {{ tag.min_len }}
            </td>
            <td>
                {{ tag.mean_len|floatformat:"0" }}
            </td>
            <td>
                {{ tag.max_len }}
            </td>
            <td>
                {{ tag.mean_gc|floatformat:"-2" }}
            </td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
</div>
    {% endif %}
</div>

{% endblock %}

{% block extra_js %}
<script>
let table = new DataTable('#tags', {
    order: [[3, 'desc']]
});
</script>


{% endblock %}